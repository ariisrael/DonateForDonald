<body class="site">
  {{> header}}
  <main>
    <div class="ui text container web-form">
      <h1>{{title}}
      </h1>
      <div class="ui subheader"><span>Donations are processed when a tweet containing your trigger is posted. Payment processing fees are <a style="display: inline-block" href="https://www.pandapay.io/pricing/" class="forgot-pass">3.9% + 30 cents per donation</a> and tax-deductible donation receipts are emailed monthly.</span>
      </div>
      <form class="ui large form" id="payment-form">
        <input type="hidden" name="_csrf" value="{{csrfToken}}">
        <div class="two fields">
          <div class="field">

            <label>First Name</label>

            <input placeholder="First Name" type="text" name="first_name" data-panda="first_name">

          </div>
          <div class="field">
            <label>Last Name</label>

            <input placeholder="Last Name" name="last_name" type="text" data-panda="last_name">
          </div>
        </div>
        <div class="fields">
          <div class="seven wide field mobile-field">
            <label>Card Number</label>
            <input type="text" name="credit_card" maxlength="16" placeholder="Card Number" data-panda="credit_card">
          </div>
          <div class="three wide field mobile-field">
            <label class="mobile-label">CVV</label>
            <input type="text" name="cvv" maxlength="4" placeholder="CVV" data-panda="cvv">
          </div>
          <br>
          <div class="six wide field mobile-field">
            <label class="mobile-label">Expiration</label>
            <input type="text" name="expiration" maxlength="7" placeholder="MM/YYYY" data-panda="expiration">
          </div>
        </div>
    <div class="maximum field">
      <div class="ui toggle inline checkbox js-maximum-toggle">
        <input type="checkbox" name="public">
        <label>Set monthly limit of </label>
      </div>
      <div class="ui labeled input disabled js-maximum-amount">
        <div class="ui basic label">$</div>
        <input type="text" placeholder="100" maxlength="4">
      </div>
    </div>
      <button class="ui primary massive button fluid save-payment-btn js-save-payment" type="submit">Save</button>

    </form>
    </div>
  </main>
  <script src="//d2t45z63lq9zlh.cloudfront.net/panda-v0.0.5.min.js"></script>

  <script>

    Panda.init('pk_test_DGoDgSY4_9eNPYwXWQyNKg', 'payment-form');

    Panda.on('success', function (cardToken) {
      // You now have a token you can use to refer to that credit card later.
      // This token is used in PandaPay API calls for creating donations and grants
      // so that you don't have to worry about security concerns with dealing with
      // credit card data.
      var data = { paymentToken: cardToken }
      if($('.js-maximum-amount input').val() && $('.js-maximum-amount input').val() !== 0 ) {
        var maximum = $('.js-maximum-amount input').val();
        data.monthlyLimit = maximum;
      }
      jQuery.ajax({
        type: 'put',
        url: '/api/users/' + user.id,
        data: data,
        success: function() {
          window.location.replace("/social");
        },
        dataType: 'json'
      })
    });

    Panda.on('error', function (errors) {
      // errors is a human-readable list of things that went wrong
      //  (invalid card number, missing last name, etc.)
      console.log(errors);
    });
  </script>
